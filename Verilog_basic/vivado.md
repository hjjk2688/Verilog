# Vivado 블록 디자인(Block Design)을 Tcl 스크립트로 관리하는 방법

이 문서는 Vivado의 IP Integrator에서 생성한 블록 디자인을 재사용하거나 다른 프로젝트로 이전하는 가장 안정적인 방법인 **Tcl 스크립트 추출 및 재구성**에 대해 설명합니다.

파일을 직접 복사하는 방식은 프로젝트 경로, IP 버전, Vivado 버전에 따라 예기치 않은 오류를 발생시킬 수 있습니다. Tcl 스크립트를 사용하면 이러한 종속성 문제를 해결하고, 디자인을 텍스트 기반으로 깔끔하게 관리할 수 있습니다.

---

## 1. 블록 디자인 내보내기 (Export)

기존 프로젝트의 블록 디자인을 Tcl 스크립트 파일로 만드는 과정입니다.

1.  내보내고 싶은 블록 디자인이 포함된 **Vivado 프로젝트를 엽니다.**

2.  상단 메뉴에서 **`File -> Export -> Export Block Design...`**을 선택합니다.

3.  **"Export Block Design"** 대화 상자가 나타나면, 생성될 Tcl 스크립트의 이름과 저장될 위치를 지정합니다.
    *   **파일 이름:** 어떤 블록 디자인인지 알아보기 쉬운 이름으로 설정하는 것이 좋습니다. (예: `my_soc_design.tcl`)
    *   **경로:** 찾기 쉬운 곳에 저장합니다.

4.  **`OK`** 버튼을 클릭하면 지정된 경로에 `.tcl` 파일이 생성됩니다. 이 파일에는 선택한 블록 디자인을 처음부터 다시 생성하는 모든 Tcl 명령어가 담겨 있습니다.

---

## 2. 블록 디자인 가져오기 (Import)

위에서 생성한 Tcl 스크립트를 사용하여 새로운 프로젝트에 블록 디자인을 복원하는 과정입니다.

1.  블록 디자인을 추가할 **새로운 Vivado 프로젝트를 엽니다.**

2.  화면 하단에 있는 **Tcl Console** 창을 클릭합니다.

3.  `source` 명령어를 사용하여 내보냈던 Tcl 스크립트 파일을 실행합니다. 경로는 **절대 경로**를 사용하는 것이 가장 확실합니다.

    ```tcl
    # Tcl Console에 아래와 같이 입력하세요.
    # 경로는 실제 파일 위치에 맞게 수정해야 합니다.
    source {C:/Users/YourName/Documents/vivado_scripts/my_soc_design.tcl}
    ```
    * **팁:** Tcl Console에서 경로를 입력할 때, Windows 경로의 `\` 대신 `/`를 사용하면 편리합니다.

4.  명령이 성공적으로 실행되면 `Sources` 창의 `Design Sources` 목록에 블록 디자인이 자동으로 추가된 것을 확인할 수 있습니다.

5.  추가된 블록 디자인 파일을 더블클릭하여 연 다음, 레이아웃이 흩어져 보일 경우 **`Regenerate Layout`** 버튼 (또는 단축키 `Ctrl + R`)을 눌러 다이어그램을 깔끔하게 정돈합니다.

---

## 3. 문제 해결: IP 모듈을 찾지 못할 때 (IP Locked)

블록 디자인을 다른 프로젝트로 옮겼을 때, 특정 IP가 **`Locked`** 상태가 되거나 IP를 찾을 수 없다는 에러가 발생하는 경우가 있습니다. 이는 새 프로젝트가 해당 IP의 소스 파일(정의)이 어디에 있는지 모르기 때문입니다.

**주요 발생 상황:**
*   Tcl 스크립트가 아닌, `.bd` 파일을 직접 복사하여 프로젝트에 추가했을 때
*   사용자 정의 IP(Custom IP)를 사용한 블록 디자인을 다른 PC나 다른 경로의 프로젝트로 옮겼을 때

**해결 방법:**

1.  **IP 저장소(Repository) 경로 추가:**
    *   상단 메뉴에서 **`Tools -> Settings`**를 엽니다.
    *   `Settings` 창 왼쪽에서 **`IP -> Repository`**를 선택합니다.
    *   오른쪽의 `+` 버튼을 눌러, 기존 프로젝트에서 사용했던 **커스텀 IP들이 저장된 폴더(디렉토리)의 경로**를 추가해줍니다. (보통 `ip_repo` 라는 이름의 폴더입니다.)
    *   `Apply`와 `OK`를 눌러 설정을 저장합니다. Vivado가 자동으로 추가된 경로를 스캔합니다.

2.  **IP 상태 업데이트 및 업그레이드:**
    *   상단 메뉴에서 **`Tools -> Report -> Report IP Status`**를 선택합니다.
    *   `IP Status` 탭이 하단에 열리면, `Locked` 상태이거나 업데이트가 필요한 IP 목록이 나타납니다.
    *   목록에서 해당 IP들을 선택한 후, 상단의 **`Upgrade Selected`** 버튼을 클릭합니다.
    *   업그레이드가 완료되면 IP의 `Locked` 상태가 해제되고 정상적으로 사용할 수 있게 됩니다.

---

## 장점 및 추가 팁

*   **안정성:** 프로젝트 경로가 바뀌거나 Vivado 버전이 달라도 스크립트는 대부분 호환되므로 디자인을 안정적으로 이전할 수 있습니다.
*   **버전 관리:** Tcl 스크립트는 텍스트 파일이므로 Git과 같은 버전 관리 시스템으로 변경 이력을 추적하고 관리하기 매우 용이합니다.
*   **자동화:** 여러 프로젝트에 동일한 기반의 블록 디자인을 적용해야 할 때 스크립트를 통해 작업을 자동화할 수 있습니다.
*   **수정 용이성:** 숙련된 사용자는 Tcl 스크립트를 직접 수정하여 블록 디자인의 일부 파라미터를 변경하거나 특정 IP를 추가/삭제하는 등의 작업을 수행할 수 있습니다.
